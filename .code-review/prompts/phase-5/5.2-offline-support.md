# Milestone 5.2: Offline Support

> **Phase:** 5 - Performance & Polish
> **Priority:** LOW
> **Status:** Pending
> **Last Updated:** 2025-12-27

---

## Problem Description

App requires constant Firebase connectivity. Users cannot work offline.

---

## Required Changes

### 1. Enable Firestore offline persistence

```dart
// In main.dart after Firebase.initializeApp()
FirebaseFirestore.instance.settings = const Settings(
  persistenceEnabled: true,
  cacheSizeBytes: Settings.CACHE_SIZE_UNLIMITED,
);
```

### 2. Show offline indicator

```dart
StreamBuilder<bool>(
  stream: ConnectivityService().onConnectivityChanged,
  builder: (context, snapshot) {
    final isOnline = snapshot.data ?? true;
    if (!isOnline) {
      return const OfflineBanner();
    }
    return const SizedBox.shrink();
  },
)
```

### 3. Queue operations for sync

```dart
class OfflineQueue {
  static Future<void> queueOperation(Map<String, dynamic> operation) async {
    final prefs = await SharedPreferences.getInstance();
    final queue = prefs.getStringList('offline_queue') ?? [];
    queue.add(jsonEncode(operation));
    await prefs.setStringList('offline_queue', queue);
  }

  static Future<void> syncQueue() async {
    // Process queued operations when back online
  }
}
```

---

## Progress Tracking

- [ ] Enable Firestore persistence
- [ ] Add offline indicator
- [ ] Implement operation queue
- [ ] Test offline functionality
- [ ] Update checklist
