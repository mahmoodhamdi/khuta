# Milestone 1.3: Fix Score Color Logic

> **Phase:** 1 - Critical Bug Fixes
> **Priority:** CRITICAL
> **Status:** Pending
> **Last Updated:** 2025-12-27

---

## Problem Description

The `getScoreColor()` function in `HomeScreenTheme` has reversed logic. Currently, ALL scores ≤80 show green, making the color feedback useless.

### Current Code (lib/core/theme/home_screen_theme.dart)

```dart
static Color getScoreColor(double score, bool isDark) {
  if (score <= 80) return accentGreen(isDark);  // ALL scores ≤80 are green!
  if (score <= 60) return accentOrange(isDark);  // NEVER reached
  return accentRed(isDark);  // NEVER reached
}
```

### The Issue

For ADHD T-Scores (Conners' Scale):
- **T-Score < 45**: Below average (GOOD - green)
- **T-Score 45-55**: Average (NEUTRAL - could be blue/gray)
- **T-Score 56-65**: Above average (WARNING - orange)
- **T-Score > 65**: Significantly elevated (CONCERN - red)

The current logic is completely wrong.

---

## Required Changes

### Step 1: Read the current file

```
Read: D:\khuta\lib\core\theme\home_screen_theme.dart
```

### Step 2: Fix the getScoreColor function

Replace the current function with corrected logic:

```dart
/// Returns color based on T-Score interpretation
/// Lower T-scores are better (less ADHD symptoms)
/// Higher T-scores indicate more concern
static Color getScoreColor(int tScore, bool isDark) {
  if (tScore < 45) {
    // Below average - good, fewer symptoms
    return accentGreen(isDark);
  } else if (tScore <= 55) {
    // Average range - neutral
    return accentBlue(isDark);
  } else if (tScore <= 65) {
    // Above average - some concern
    return accentOrange(isDark);
  } else {
    // Significantly elevated - needs attention
    return accentRed(isDark);
  }
}
```

### Step 3: Update all usages

Search for usages of `getScoreColor` and ensure they pass `int` instead of `double`:

```bash
# Find all usages
grep -r "getScoreColor" lib/
```

Update any calls if necessary:
```dart
// Before
HomeScreenTheme.getScoreColor(score.toDouble(), isDark)

// After
HomeScreenTheme.getScoreColor(score, isDark)
```

### Step 4: Add a helper method for score interpretation

Add this method to `HomeScreenTheme` for consistency:

```dart
/// Returns a severity level string for the score
static String getScoreSeverity(int tScore) {
  if (tScore < 45) return 'low';
  if (tScore <= 55) return 'average';
  if (tScore <= 65) return 'elevated';
  return 'high';
}
```

---

## Acceptance Criteria

- [ ] Scores < 45 show GREEN (low concern)
- [ ] Scores 45-55 show BLUE (average)
- [ ] Scores 56-65 show ORANGE (elevated)
- [ ] Scores > 65 show RED (high concern)
- [ ] All usages updated to use correct type
- [ ] `flutter analyze` passes

---

## Files to Modify

| File | Action |
|------|--------|
| `lib/core/theme/home_screen_theme.dart` | Fix color logic |
| Any files calling `getScoreColor` | Update parameter type if needed |

---

## Visual Testing

After fix, verify in the app:
1. Create a child
2. Complete an assessment
3. Check that the score color matches the severity
4. Low scores should be green, high scores should be red

---

## Progress Tracking

- [ ] Step 1: Read current file
- [ ] Step 2: Fix getScoreColor function
- [ ] Step 3: Update all usages
- [ ] Step 4: Add helper method
- [ ] Step 5: Visual testing
- [ ] Step 6: Update checklist

---

## Completion

When done, update:
1. `.code-review/MASTER_PLAN.md` - Change milestone 1.3 status to "Done"
2. `.code-review/checklists/phase-1-checklist.md` - Mark item complete
