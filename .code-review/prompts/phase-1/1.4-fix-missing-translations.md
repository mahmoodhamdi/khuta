# Milestone 1.4: Fix Missing Translations

> **Phase:** 1 - Critical Bug Fixes
> **Priority:** HIGH
> **Status:** Pending
> **Last Updated:** 2025-12-27

---

## Problem Description

Several translation keys in `SdqScoringService` are missing the `.tr()` call, causing untranslated text to appear for Arabic users.

### Current Code (lib/core/services/sdq_scoring_service.dart)

```dart
static String getScoreInterpretation(int tScore) {
  if (tScore >= 70) {
    return 'extremely_above_average'.tr();  // OK
  } else if (tScore >= 66) {
    return 'significantly_above_average'.tr();  // OK
  } else if (tScore >= 61) {
    return 'above_average'.tr();  // OK
  } else if (tScore >= 56) {
    return 'slightly_above_average'.tr();  // OK
  } else if (tScore >= 45) {
    return 'average';  // BUG: Missing .tr()
  } else if (tScore >= 40) {
    return 'slightly_below_average'.tr();  // OK
  } else if (tScore >= 35) {
    return 'below_average';  // BUG: Missing .tr()
  } else if (tScore >= 30) {
    return 'significantly_below_average'.tr();  // OK
  } else {
    return 'extremely_below_average'.tr();  // OK
  }
}
```

---

## Required Changes

### Step 1: Read and analyze translation files

```
Read: D:\khuta\lib\core\services\sdq_scoring_service.dart
Read: D:\khuta\assets\translations\en.json
Read: D:\khuta\assets\translations\ar.json
```

### Step 2: Fix missing .tr() calls in SdqScoringService

Update the function:

```dart
static String getScoreInterpretation(int tScore) {
  if (tScore >= 70) {
    return 'extremely_above_average'.tr();
  } else if (tScore >= 66) {
    return 'significantly_above_average'.tr();
  } else if (tScore >= 61) {
    return 'above_average'.tr();
  } else if (tScore >= 56) {
    return 'slightly_above_average'.tr();
  } else if (tScore >= 45) {
    return 'average'.tr();  // FIXED: Added .tr()
  } else if (tScore >= 40) {
    return 'slightly_below_average'.tr();
  } else if (tScore >= 35) {
    return 'below_average'.tr();  // FIXED: Added .tr()
  } else if (tScore >= 30) {
    return 'significantly_below_average'.tr();
  } else {
    return 'extremely_below_average'.tr();
  }
}
```

### Step 3: Verify translation keys exist

Check that these keys exist in both translation files:

**Required keys:**
- `extremely_above_average`
- `significantly_above_average`
- `above_average`
- `slightly_above_average`
- `average`
- `slightly_below_average`
- `below_average`
- `significantly_below_average`
- `extremely_below_average`

### Step 4: Add any missing translation keys

If any keys are missing, add them:

**en.json:**
```json
{
  "average": "Average",
  "below_average": "Below Average",
  "above_average": "Above Average",
  "slightly_above_average": "Slightly Above Average",
  "significantly_above_average": "Significantly Above Average",
  "extremely_above_average": "Extremely Above Average",
  "slightly_below_average": "Slightly Below Average",
  "significantly_below_average": "Significantly Below Average",
  "extremely_below_average": "Extremely Below Average"
}
```

**ar.json:**
```json
{
  "average": "متوسط",
  "below_average": "أقل من المتوسط",
  "above_average": "أعلى من المتوسط",
  "slightly_above_average": "أعلى قليلاً من المتوسط",
  "significantly_above_average": "أعلى بشكل ملحوظ من المتوسط",
  "extremely_above_average": "أعلى بشكل كبير من المتوسط",
  "slightly_below_average": "أقل قليلاً من المتوسط",
  "significantly_below_average": "أقل بشكل ملحوظ من المتوسط",
  "extremely_below_average": "أقل بشكل كبير من المتوسط"
}
```

### Step 5: Search for other missing translations

Run a search for strings that might be missing translations:

```bash
# Find hardcoded strings that should be translated
grep -rn "return '" lib/ | grep -v ".tr()"
```

---

## Acceptance Criteria

- [ ] All `getScoreInterpretation` returns use `.tr()`
- [ ] All translation keys exist in en.json
- [ ] All translation keys exist in ar.json
- [ ] App displays correct text in both languages
- [ ] `flutter analyze` passes

---

## Files to Modify

| File | Action |
|------|--------|
| `lib/core/services/sdq_scoring_service.dart` | Add missing .tr() calls |
| `assets/translations/en.json` | Verify/add keys |
| `assets/translations/ar.json` | Verify/add keys |

---

## Testing

1. Change app language to Arabic
2. Complete an assessment
3. Verify score interpretation shows in Arabic
4. Change back to English
5. Verify English text is correct

---

## Progress Tracking

- [ ] Step 1: Read translation files
- [ ] Step 2: Fix .tr() calls
- [ ] Step 3: Verify keys exist
- [ ] Step 4: Add missing keys
- [ ] Step 5: Search for other issues
- [ ] Step 6: Test both languages
- [ ] Step 7: Update checklist

---

## Completion

When done, update:
1. `.code-review/MASTER_PLAN.md` - Change milestone 1.4 status to "Done"
2. `.code-review/checklists/phase-1-checklist.md` - Mark item complete
